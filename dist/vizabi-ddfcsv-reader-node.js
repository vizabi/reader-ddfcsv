module.exports=function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),o=r(1);e.BackendFileReader=o.BackendFileReader;var i=r(3),u=r(3);e.GithubFileReader=u.GithubFileReader;var a=r(4);e.DdfCsvError=a.DdfCsvError;var s=r(5);e.getDDFCsvReaderObject=s.prepareDDFCsvReaderObject(new n.BackendFileReader),e.getGithubDDFCsvReaderObject=s.prepareDDFCsvReaderObject(new i.GithubFileReader)},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(2),u=function(){function t(){n(this,t)}return o(t,[{key:"setRecordTransformer",value:function(t){this.recordTransformer=t}},{key:"readText",value:function(t,e){return i.existsSync(t)?void i.readFile(t,"utf-8",function(t,r){return t?void e(t):void e(null,r.toString())}):e("No such file: "+t)}}]),t}();e.BackendFileReader=u},function(t,e){t.exports=require("fs")},function(t,e){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){r(this,t)}return n(t,[{key:"setRecordTransformer",value:function(t){this.recordTransformer=t}},{key:"readText",value:function(t,e){}}]),t}();e.GithubFileReader=o},function(t,e){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.FILE_READING_ERROR="File reading error",e.JSON_PARSING_ERROR="JSON parsing error",e.CSV_PARSING_ERROR="CSV parsing error",e.DDF_ERROR="DDF error";var i=function(t){function e(t,o,i){r(this,e);var u=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return u.name="DdfCsvError",u.message=t+" [filepath: "+i+"]. "+o+".",u.details=o,u.file=i,u}return o(e,t),e}(Error);e.DdfCsvError=i},function(t,e,r){"use strict";function n(t){return function(e,r){return{init:function(n){this._basePath=n.path,this._lastModified=n._lastModified,this.fileReader=e||t,this.logger=r,this.resultTransformer=n.resultTransformer,this.datasetsConfig=n.datasetsConfig,this.isLocalReader=!!i(this.datasetsConfig),this.isServerReader=!this.isLocalReader,this.reader=a.ddfCsvReader({basePath:this._basePath,fileReader:this.fileReader,logger:this.logger,datasetsConfig:this.datasetsConfig})},getAsset:function(t){var e=this,r=".json"===t.slice(-".json".length),n=this._basePath+"/"+t;return u(t)&&(n=s.getDatasetPath(this._basePath,t)),new Promise(function(t,o){e.fileReader.readText(n,function(e,n){if(e)return void o(e);if(r)try{t(JSON.parse(n))}catch(t){o(e)}else t(n)})})},read:function(t,e){return o.__awaiter(this,void 0,void 0,regeneratorRuntime.mark(function n(){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=void 0,n.prev=1,n.next=4,this.reader.query(t);case 4:o=n.sent,o=e?this._prettifyData(o,e):o,this.resultTransformer&&(o=this.resultTransformer(o)),this.logger&&this.logger.log&&(r.log(JSON.stringify(t),o.length),r.log(o)),n.next=13;break;case 10:throw n.prev=10,n.t0=n.catch(1),n.t0;case 13:return n.abrupt("return",o);case 14:case"end":return n.stop()}},n,this,[[1,10]])}))},_prettifyData:function(t,e){return t.map(function(t){var r=Object.keys(t);return r.forEach(function(r){e[r]&&(t[r]=e[r](t[r]))}),t})}}}}Object.defineProperty(e,"__esModule",{value:!0});var o=r(6),i=r(7),u=r(8),a=r(9),s=r(109);e.prepareDDFCsvReaderObject=n},function(t,e,r){var n,o,i,u,a,s,c,f,l,p,h,d,y,v,m,b,_,g,w,x,S,k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(r){function i(t,e){return t!==u&&("function"==typeof Object.create?Object.defineProperty(t,"__esModule",{value:!0}):t.__esModule=!0),function(r,n){return t[r]=e?e(r,n):n}}var u="object"===("undefined"==typeof global?"undefined":k(global))?global:"object"===("undefined"==typeof self?"undefined":k(self))?self:"object"===k(this)?this:{};n=[e],o=function(t){r(i(u,i(t)))}.apply(e,n),!(void 0!==o&&(t.exports=o))}(function(t){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};i=function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},u=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},a=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&(r[n[o]]=t[n[o]]);return r},s=function(t,e,r,n){var o,i=arguments.length,u=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"===("undefined"==typeof Reflect?"undefined":k(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(u=(i<3?o(u):i>3?o(e,r,u):o(e,r))||u);return i>3&&u&&Object.defineProperty(e,r,u),u},c=function(t,e){return function(r,n){e(r,n,t)}},f=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":k(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},l=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function u(t){try{s(n.next(t))}catch(t){i(t)}}function a(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(u,a)}s((n=n.apply(t,e||[])).next())})},p=function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(u=2&r[0]?i.return:r[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,r[1])).done)return u;switch(i=0,u&&(r=[2&r[0],u.value]),r[0]){case 0:case 1:u=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(u=s.trys,!(u=u.length>0&&u[u.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!u||r[1]>u[0]&&r[1]<u[3])){s.label=r[1];break}if(6===r[0]&&s.label<u[1]){s.label=u[1],u=r;break}if(u&&s.label<u[2]){s.label=u[2],s.ops.push(r);break}u[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{o=u=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,i,u,a,s={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},h=function(t,e){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])},d=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},y=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)u.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return u},v=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(y(arguments[e]));return t},m=function(t){return this instanceof m?(this.v=t,this):new m(t)},b=function(t,e,r){function n(t){f[t]&&(c[t]=function(e){return new Promise(function(r,n){l.push([t,e,r,n])>1||o(t,e)})})}function o(t,e){try{i(f[t](e))}catch(t){s(l[0][3],t)}}function i(t){t.value instanceof m?Promise.resolve(t.value.v).then(u,a):s(l[0][2],t)}function u(t){o("next",t)}function a(t){o("throw",t)}function s(t,e){t(e),l.shift(),l.length&&o(l[0][0],l[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,f=r.apply(t,e||[]),l=[];return c={},n("next"),n("throw"),n("return"),c[Symbol.asyncIterator]=function(){return this},c},_=function(t){function e(e,o){r[e]=t[e]?function(r){return(n=!n)?{value:m(t[e](r)),done:"return"===e}:o?o(r):r}:o}var r,n;return r={},e("next"),e("throw",function(t){throw t}),e("return"),r[Symbol.iterator]=function(){return this},r},g=function(t){function e(e){n[e]=t[e]&&function(n){return new Promise(function(o,i){n=t[e](n),r(o,i,n.done,n.value)})}}function r(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=t[Symbol.asyncIterator];return o?o.call(t):(t="function"==typeof d?d(t):t[Symbol.iterator](),n={},e("next"),e("throw"),e("return"),n[Symbol.asyncIterator]=function(){return this},n)},w=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},x=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e},S=function(t){return t&&t.__esModule?t:{default:t}},t("__extends",i),t("__assign",u),t("__rest",a),t("__decorate",s),t("__param",c),t("__metadata",f),t("__awaiter",l),t("__generator",p),t("__exportStar",h),t("__values",d),t("__read",y),t("__spread",v),t("__await",m),t("__asyncGenerator",b),t("__asyncDelegator",_),t("__asyncValues",g),t("__makeTemplateObject",w),t("__importStar",x),t("__importDefault",S)})},function(t,e){"use strict";function r(t){return null==t}t.exports=r},function(t,e){"use strict";function r(t){var e="undefined"==typeof t?"undefined":n(t);return null!=t&&("object"==e||"function"==e)}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=r},function(t,e,r){"use strict";function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function i(t){function e(t){return new Promise(function(e,r){K.readText(t,function(n,o){if(n)return r(new p.DdfCsvError(p.FILE_READING_ERROR,n,t));var i=void 0;try{i=JSON.parse(o),rt=[],H(i),V(i)}catch(e){return r(new p.DdfCsvError(p.JSON_PARSING_ERROR,e.message,t))}e(i)})})}function r(t,e){return s.__awaiter(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,o,u;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return m(Y,e),n={select:{key:["concept"],value:["concept_type","domain"]},from:"concepts",dataset:t.dataset,branch:t.branch,commit:t.commit},o=void 0,r.prev=3,r.next=6,_(n,e);case 6:return u=r.sent,i(u,e),r.next=10,v(e);case 10:o=r.sent,r.next=16;break;case 13:throw r.prev=13,r.t0=r.catch(3),r.t0;case 16:return r.abrupt("return",o);case 17:case"end":return r.stop()}},r,this,[[3,13]])}))}function i(t,e){var r=t.filter(function(t){return"entity_set"===t.concept_type}).map(function(t){return{concept:"is--"+t.concept,concept_type:"boolean",domain:null}});t=t.concat(r).concat(Y),m(t,e)}function v(t){var e=t.conceptsLookup,r=new Map([["boolean",function(t){return"true"===t||"TRUE"===t}],["measure",function(t){return parseFloat(t)}]]),n=D(["concept"]),i=[].concat(o(n)).map(function(t){return t.data.then(function(t){var n=Object.keys(t.data[0]),o=new Map;return n.forEach(function(t){var n=e.get(t).concept_type,i=r.get(n);i&&o.set(t,i)}),t.data.forEach(function(t){var e=!0,r=!1,n=void 0;try{for(var i,u=o[Symbol.iterator]();!(e=(i=u.next()).done);e=!0){var s=a(i.value,2),c=s[0],f=s[1];t[c]=f(t[c])}}catch(t){r=!0,n=t}finally{try{!e&&u.return&&u.return()}finally{if(r)throw n}}})})});return Promise.all(i)}function m(t,e){e.conceptsLookup.clear(),t.forEach(function(t){return e.conceptsLookup.set(t.concept,t)})}function b(t){return s.__awaiter(this,void 0,void 0,regeneratorRuntime.mark(function n(){var o,i,u,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=void 0,n.prev=1,Z.fileReader=K,n.next=5,h.validateQueryStructure(t,Z);case 5:return n.next=7,h.extendQueryParamWithDatasetProps(t,Z);case 7:return n.next=9,e(Z.datapackagePath);case 9:return i=n.sent,Z.datapackage=i,n.next=13,r(t,Z);case 13:return n.next=15,h.validateQueryDefinitions(t,Z);case 15:if(!h.isSchemaQuery(t)){n.next=21;break}return n.next=18,S(t,{datapackage:i});case 18:o=n.sent,n.next=31;break;case 21:if(u=l.getAppropriatePlugin(t,Z),!u){n.next=28;break}return rt=[],n.next=26,u.getOptimalFilesSet();case 26:a=n.sent,rt=a;case 28:return n.next=30,_(t,Z);case 30:o=n.sent;case 31:n.next=36;break;case 33:throw n.prev=33,n.t0=n.catch(1),n.t0;case 36:return n.abrupt("return",o);case 37:case"end":return n.stop()}},n,this,[[1,33]])}))}function _(t,e){var r=t.select,n=r.key,i=void 0===n?[]:n,u=r.value,s=void 0===u?[]:u,c=(t.from,t.where),f=void 0===c?{}:c,l=t.join,p=void 0===l?{}:l,h=t.order_by,d=void 0===h?[]:h,y=t.language,v={key:i,value:s},m=new Set(v.key.concat(v.value)),b=R(f).filter(function(t){return!m.has(t)}),_=L(v.key,[].concat(o(v.value),o(b)),y,e),S=O(p,t,e),j=P(v.key,t,e);return Promise.all([_,j,S]).then(function(t){var r=a(t,3),n=r[0],i=r[1],u=r[2],s=w(f,u),c=x(i,s),l=n.map(function(t){return I(t,v,b,e)}),p=N.apply(void 0,[v.key,"overwrite"].concat(o(l))).filter(function(t){return E(t,c)}).map(function(t){return k(t,m)}).map(function(t){return F(t,m)});return g(p,d),p})}function g(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0!==e.length){var r=e.map(function(t){if("string"==typeof t)return{concept:t,direction:1};var e=Object.keys(t)[0],r="asc"===t[e]?1:-1;return{concept:e,direction:r}}),n=r.length;t.sort(function(t,e){for(var o=0;o<n;o++){var i=r[o];if(t[i.concept]<e[i.concept])return-1*i.direction;if(t[i.concept]>e[i.concept])return 1*i.direction}return 0})}}function w(t,e){var r={};for(var n in t){var o=t[n];["$and","$or","$nor"].includes(n)?r[n]=o.map(function(t){return w(t,e)}):"$in"===n||"$nin"===n?r[n]=new Set(o):"undefined"!=typeof e[o]?Object.assign(r,e[o]):"object"===("undefined"==typeof o?"undefined":u(o))?r[n]=w(o,e):r[n]=o}return r}function x(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.reduce(function(t,e){return t.$and.push(e),t},{$and:[]})}function S(t,e){var r=e.datapackage,n=function(t){return r.ddfSchema[t].map(function(t){var e=t.primaryKey,r=t.value;return{key:e,value:r}})},o=t.from.split(".")[0];return r.ddfSchema[o]?n(o):"*"===o?Object.keys(r.ddfSchema).map(n).reduce(function(t,e){return t.concat(e)}):void z(new p.DdfCsvError(p.DDF_ERROR,"No valid collection ("+o+") for schema query"))}function k(t,e){var r=!0,n=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){var a=i.value;"undefined"==typeof t[a]&&(t[a]=null)}}catch(t){n=!0,o=t}finally{try{!r&&u.return&&u.return()}finally{if(n)throw o}}return t}function E(t,e){return Object.keys(e).every(function(r){var n=X.get(r);return n?n(t,e[r]):"object"!==u(e[r])?X.get("$eq")(t[r],e[r]):E(t[r],e[r])})}function O(t,e,r){return Promise.all(Object.keys(t).map(function(n){return A(n,t[n],e,r)})).then(function(t){return t.reduce(j,{})})}function j(t,e){return Object.assign(t,e)}function A(t,e,r,o){return"time"===o.conceptsLookup.get(e.key).concept_type?Promise.resolve(n({},t,e.where)):b({select:{key:[e.key]},where:e.where,from:o.conceptsLookup.has(e.key)?"concepts":"entities",dataset:r.dataset,branch:r.branch,commit:r.commit}).then(function(r){return n({},t,n({},e.key,{$in:new Set(r.map(function(t){return t[e.key]}))}))})}function R(t){var e=[];for(var r in t)["$and","$or","$not","$nor"].includes(r)?t[r].map(R).forEach(function(t){return e.push.apply(e,o(t))}):e.push(r);return e}function C(t,e,r){var n=e||Array.from(r.conceptsLookup.keys()),o=[],i=!0,u=!1,a=void 0;try{for(var s,c=n[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var f=s.value,l=r.conceptsLookup.get(f);t.includes(l.concept_type)&&o.push(l)}}catch(t){u=!0,a=t}finally{try{!i&&c.return&&c.return()}finally{if(u)throw a}}return o}function T(t,e,r){var n=new Set(e),i=["entity_set","entity_domain"],u=C(i,t,r);if(0===u.length)return new Map;var a=C(i,null,r);return u.map(function(t){return a.filter(function(e){return"entity_set"===t.concept_type?n.has(e.concept)&&e.concept!==t.concept&&(e.domain===t.domain||e.concept===t.domain):n.has(e.concept)&&e.concept!==t.concept&&e.domain===t.concept}).reduce(function(e,r){return e.set(r.concept,t.concept)},new Map)}).reduce(function(t,e){return new Map([].concat(o(t),o(e)))},new Map)}function P(t,e,r){var o=C(["entity_set"],t,r).map(function(t){return b({select:{key:[t.domain],value:["is--"+t.concept]},from:"entities",dataset:e.dataset,branch:e.branch,commit:e.commit}).then(function(e){return n({},t.concept,{$in:new Set(e.filter(function(e){return e["is--"+t.concept]}).map(function(e){return e[t.domain]}))})})});return Promise.all(o).then(function(t){return t.reduce(function(t,e){return Object.assign(t,e)},{})})}function D(t,e){if(!e||0===e.length)return new Set([].concat(o(tt.get(U(t)).values())).reduce(function(t,e){return t.concat(e)}));if(Array.isArray(e))return e.map(function(e){return D(t,e)}).reduce(function(t,e){return new Set([].concat(o(t),o(e)))},new Set);var r=tt.get(U(t)).get(e);return r&&(r=r.filter(function(t){return f(rt)||c(rt,t.path)})),new Set(r)}function I(t,e,r,n){var i=t.resource.schema.primaryKey,u=new Set([].concat(o(i),o(e.value),o(r))),a=T(e.key,i,n);return t.data.map(function(t){return F(t,u)}).map(function(t){return M(t,a)})}function L(t,e,r,n){var i=D(t,e);return Promise.all([].concat(o(i)).map(function(t){return B(t,r,n)}))}function F(t,e){var r={};for(var n in t)e.has(n)&&(r[n]=t[n]);return r}function M(t,e){var r={};for(var n in t)r[e.get(n)||n]=t[n];return r}function N(t,e){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];if(1===n.length)return n[0];var u=t.slice(0).sort(),a=n.reduce(function(t,r){return r.forEach(function(r){var n=u.map(function(t){return r[t]}).join(",");if(t.has(n)){var o=t.get(n);$(o,r,e)}else t.set(n,r)}),t},new Map);return[].concat(o(a.values()))}function $(t,e,r){switch(r){case"overwrite":Object.assign(t,e);break;case"translation":for(var n in e)""!==e[n]&&(t[n]=e[n]);break;case"overwriteWithError":for(var o in e)if(void 0!==t[o]&&t[o]!==e[o]){var i=JSON.stringify(e),u=JSON.stringify(t),a='JOIN Error: two resources have different data for "'+o+'": '+i+","+u;z(new p.DdfCsvError(p.DDF_ERROR,a))}else t[o]=e[o]}}function z(t){var e=W||console;throw e.error(t.message),t}function U(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.slice(0).sort();return e?r.map(function(t){return e[t]}).join(","):r.join(",")}function B(t,e,r){var n=[];"undefined"==typeof t.data&&(t.data=Q(r.datasetPath+"/"+t.path,r)),n.push(t.data);var i="undefined"!=typeof e&&q(r).includes(e),u="undefined"!=typeof t.translations[e];if(i){if(!u){var a=r.datasetPath+"/lang/"+e+"/"+t.path;t.translations[e]=Q(a,r).catch(function(t){return Promise.resolve({})})}n.push(t.translations[e])}return Promise.all(n).then(function(e){var r=e.map(function(t){return t.data||[]}),n=t.schema.primaryKey,i=N.apply(void 0,[n,"translation"].concat(o(r)));return{data:i,resource:t}})}function q(t){var e=t.datapackage;return e.translations?e.translations.map(function(t){return t.id}):[]}function Q(t,e){return new Promise(function(r,n){K.readText(t,function(o,i){return o?n(new p.DdfCsvError(p.FILE_READING_ERROR,o,t)):void d.parse(i,{header:!0,skipEmptyLines:!0,dynamicTyping:function(t){if(!e.conceptsLookup)return!0;var r=e.conceptsLookup.get(t)||{};return["boolean","measure"].includes(r.concept_type)},complete:function(t){return r(t)},error:function(e){return n(new p.DdfCsvError(p.CSV_PARSING_ERROR,e,t))}})})})}function H(t){return et.size>0?et:(t.resources.forEach(function(t){Array.isArray(t.schema.primaryKey)||(t.schema.primaryKey=[t.schema.primaryKey]),t.translations={},et.set(t.name,t)}),et)}function V(t){if(tt.size>0)return tt;for(var e in t.ddfSchema)t.ddfSchema[e].map(function(t){var e=U(t.primaryKey),r=t.resources.map(function(t){return et.get(t)});tt.has(e)?tt.get(e).set(t.value,r):tt.set(e,new Map([[t.value,r]]))});return tt}var G=t.basePath,K=t.fileReader,W=t.logger,J=t.datasetsConfig,Y=[{concept:"concept",concept_type:"string",domain:null},{concept:"concept_type",concept_type:"string",domain:null}],X=new Map([["$and",function(t,e){return e.every(function(e){return E(t,e)})}],["$or",function(t,e){return e.some(function(e){return E(t,e)})}],["$not",function(t,e){return!E(t,e)}],["$nor",function(t,e){return!e.some(function(e){return E(t,e)})}],["$eq",function(t,e){return t==e}],["$ne",function(t,e){return t!=e}],["$gt",function(t,e){return y(t)&&t>e}],["$gte",function(t,e){return y(t)&&t>=e}],["$lt",function(t,e){return y(t)&&t<e}],["$lte",function(t,e){return y(t)&&t<=e}],["$in",function(t,e){return e.has(t)}],["$nin",function(t,e){return!e.has(t)}]]),Z={basePath:G,datasetsConfig:J,conceptsLookup:new Map,datapackagePath:"",datasetPath:"",dataset:""},tt=new Map,et=new Map,rt=[];return{query:b}}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function t(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var u,a=t[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(o)throw i}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();Object.defineProperty(e,"__esModule",{value:!0});var s=r(6),c=r(10),f=r(51),l=r(64),p=r(4),h=r(109),d=r(108),y=function(t){return!("number"!=typeof t&&!t)};e.ddfCsvReader=i},function(t,e,r){"use strict";function n(t,e,r,n){t=i(t)?t:s(t),r=r&&!n?a(r):0;var f=t.length;return r<0&&(r=c(f+r,0)),u(t)?r<=f&&t.indexOf(e,r)>-1:!!f&&o(t,e,r)>-1}var o=r(11),i=r(15),u=r(24),a=r(27),s=r(31),c=Math.max;t.exports=n},function(t,e,r){"use strict";function n(t,e,r){return e===e?u(t,e,r):o(t,i,r)}var o=r(12),i=r(13),u=r(14);t.exports=n},function(t,e){"use strict";function r(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}t.exports=r},function(t,e){"use strict";function r(t){return t!==t}t.exports=r},function(t,e){"use strict";function r(t,e,r){for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1}t.exports=r},function(t,e,r){"use strict";function n(t){return null!=t&&i(t.length)&&!o(t)}var o=r(16),i=r(23);t.exports=n},function(t,e,r){"use strict";function n(t){if(!i(t))return!1;var e=o(t);return e==a||e==s||e==u||e==c}var o=r(17),i=r(8),u="[object AsyncFunction]",a="[object Function]",s="[object GeneratorFunction]",c="[object Proxy]";t.exports=n},function(t,e,r){"use strict";function n(t){return null==t?void 0===t?s:a:c&&c in Object(t)?i(t):u(t)}var o=r(18),i=r(21),u=r(22),a="[object Null]",s="[object Undefined]",c=o?o.toStringTag:void 0;t.exports=n},function(t,e,r){"use strict";var n=r(19),o=n.Symbol;t.exports=o},function(t,e,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=r(20),i="object"==("undefined"==typeof self?"undefined":n(self))&&self&&self.Object===Object&&self,u=o||i||Function("return this")();t.exports=u},function(t,e){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n="object"==("undefined"==typeof global?"undefined":r(global))&&global&&global.Object===Object&&global;t.exports=n},function(t,e,r){"use strict";function n(t){var e=u.call(t,s),r=t[s];try{t[s]=void 0;var n=!0}catch(t){}var o=a.call(t);return n&&(e?t[s]=r:delete t[s]),o}var o=r(18),i=Object.prototype,u=i.hasOwnProperty,a=i.toString,s=o?o.toStringTag:void 0;t.exports=n},function(t,e){"use strict";function r(t){return o.call(t)}var n=Object.prototype,o=n.toString;t.exports=r},function(t,e){"use strict";function r(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}var n=9007199254740991;t.exports=r},function(t,e,r){"use strict";function n(t){return"string"==typeof t||!i(t)&&u(t)&&o(t)==a}var o=r(17),i=r(25),u=r(26),a="[object String]";t.exports=n},function(t,e){"use strict";var r=Array.isArray;t.exports=r},function(t,e){"use strict";function r(t){return null!=t&&"object"==("undefined"==typeof t?"undefined":n(t))}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=r},function(t,e,r){"use strict";function n(t){var e=o(t),r=e%1;return e===e?r?e-r:e:0}var o=r(28);t.exports=n},function(t,e,r){"use strict";function n(t){if(!t)return 0===t?t:0;if(t=o(t),t===i||t===-i){var e=t<0?-1:1;return e*u}return t===t?t:0}var o=r(29),i=1/0,u=1.7976931348623157e308;t.exports=n},function(t,e,r){"use strict";function n(t){if("number"==typeof t)return t;if(i(t))return u;if(o(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var r=c.test(t);return r||f.test(t)?l(t.slice(2),r?2:8):s.test(t)?u:+t}var o=r(8),i=r(30),u=NaN,a=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,f=/^0o[0-7]+$/i,l=parseInt;t.exports=n},function(t,e,r){"use strict";function n(t){return"symbol"==("undefined"==typeof t?"undefined":o(t))||u(t)&&i(t)==a}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=r(17),u=r(26),a="[object Symbol]";t.exports=n},function(t,e,r){"use strict";function n(t){return null==t?[]:o(t,i(t))}var o=r(32),i=r(34);t.exports=n},function(t,e,r){"use strict";function n(t,e){return o(e,function(e){return t[e]})}var o=r(33);t.exports=n},function(t,e){"use strict";function r(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}t.exports=r},function(t,e,r){"use strict";function n(t){return u(t)?o(t):i(t)}var o=r(35),i=r(47),u=r(15);t.exports=n},function(t,e,r){"use strict";function n(t,e){var r=u(t),n=!r&&i(t),f=!r&&!n&&a(t),p=!r&&!n&&!f&&c(t),h=r||n||f||p,d=h?o(t.length,String):[],y=d.length;for(var v in t)!e&&!l.call(t,v)||h&&("length"==v||f&&("offset"==v||"parent"==v)||p&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||s(v,y))||d.push(v);return d}var o=r(36),i=r(37),u=r(25),a=r(39),s=r(42),c=r(43),f=Object.prototype,l=f.hasOwnProperty;t.exports=n},function(t,e){"use strict";function r(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}t.exports=r},function(t,e,r){"use strict";var n=r(38),o=r(26),i=Object.prototype,u=i.hasOwnProperty,a=i.propertyIsEnumerable,s=n(function(){return arguments}())?n:function(t){return o(t)&&u.call(t,"callee")&&!a.call(t,"callee")};t.exports=s},function(t,e,r){"use strict";function n(t){return i(t)&&o(t)==u}var o=r(17),i=r(26),u="[object Arguments]";t.exports=n},function(t,e,r){(function(t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=r(19),i=r(41),u="object"==n(e)&&e&&!e.nodeType&&e,a=u&&"object"==n(t)&&t&&!t.nodeType&&t,s=a&&a.exports===u,c=s?o.Buffer:void 0,f=c?c.isBuffer:void 0,l=f||i;t.exports=l}).call(e,r(40)(t))},function(t,e){"use strict";t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e){"use strict";function r(){return!1}t.exports=r},function(t,e){"use strict";function r(t,e){return e=null==e?n:e,!!e&&("number"==typeof t||o.test(t))&&t>-1&&t%1==0&&t<e}var n=9007199254740991,o=/^(?:0|[1-9]\d*)$/;t.exports=r},function(t,e,r){"use strict";var n=r(44),o=r(45),i=r(46),u=i&&i.isTypedArray,a=u?o(u):n;t.exports=a},function(t,e,r){"use strict";function n(t){return u(t)&&i(t.length)&&!!T[o(t)]}var o=r(17),i=r(23),u=r(26),a="[object Arguments]",s="[object Array]",c="[object Boolean]",f="[object Date]",l="[object Error]",p="[object Function]",h="[object Map]",d="[object Number]",y="[object Object]",v="[object RegExp]",m="[object Set]",b="[object String]",_="[object WeakMap]",g="[object ArrayBuffer]",w="[object DataView]",x="[object Float32Array]",S="[object Float64Array]",k="[object Int8Array]",E="[object Int16Array]",O="[object Int32Array]",j="[object Uint8Array]",A="[object Uint8ClampedArray]",R="[object Uint16Array]",C="[object Uint32Array]",T={};T[x]=T[S]=T[k]=T[E]=T[O]=T[j]=T[A]=T[R]=T[C]=!0,T[a]=T[s]=T[g]=T[c]=T[w]=T[f]=T[l]=T[p]=T[h]=T[d]=T[y]=T[v]=T[m]=T[b]=T[_]=!1,t.exports=n},function(t,e){"use strict";function r(t){return function(e){return t(e)}}t.exports=r},function(t,e,r){(function(t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=r(20),i="object"==n(e)&&e&&!e.nodeType&&e,u=i&&"object"==n(t)&&t&&!t.nodeType&&t,a=u&&u.exports===i,s=a&&o.process,c=function(){try{return s&&s.binding&&s.binding("util")}catch(t){}}();t.exports=c}).call(e,r(40)(t))},function(t,e,r){"use strict";function n(t){if(!o(t))return i(t);var e=[];for(var r in Object(t))a.call(t,r)&&"constructor"!=r&&e.push(r);return e}var o=r(48),i=r(49),u=Object.prototype,a=u.hasOwnProperty;t.exports=n},function(t,e){"use strict";function r(t){var e=t&&t.constructor,r="function"==typeof e&&e.prototype||n;return t===r}var n=Object.prototype;t.exports=r},function(t,e,r){"use strict";var n=r(50),o=n(Object.keys,Object);t.exports=o},function(t,e){"use strict";function r(t,e){return function(r){return t(e(r))}}t.exports=r},function(t,e,r){"use strict";function n(t){if(null==t)return!0;if(s(t)&&(a(t)||"string"==typeof t||"function"==typeof t.splice||c(t)||l(t)||u(t)))return!t.length;var e=i(t);if(e==p||e==h)return!t.size;if(f(t))return!o(t).length;for(var r in t)if(y.call(t,r))return!1;return!0}var o=r(47),i=r(52),u=r(37),a=r(25),s=r(15),c=r(39),f=r(48),l=r(43),p="[object Map]",h="[object Set]",d=Object.prototype,y=d.hasOwnProperty;t.exports=n},function(t,e,r){"use strict";var n=r(53),o=r(60),i=r(61),u=r(62),a=r(63),s=r(17),c=r(58),f="[object Map]",l="[object Object]",p="[object Promise]",h="[object Set]",d="[object WeakMap]",y="[object DataView]",v=c(n),m=c(o),b=c(i),_=c(u),g=c(a),w=s;
(n&&w(new n(new ArrayBuffer(1)))!=y||o&&w(new o)!=f||i&&w(i.resolve())!=p||u&&w(new u)!=h||a&&w(new a)!=d)&&(w=function(t){var e=s(t),r=e==l?t.constructor:void 0,n=r?c(r):"";if(n)switch(n){case v:return y;case m:return f;case b:return p;case _:return h;case g:return d}return e}),t.exports=w},function(t,e,r){"use strict";var n=r(54),o=r(19),i=n(o,"DataView");t.exports=i},function(t,e,r){"use strict";function n(t,e){var r=i(t,e);return o(r)?r:void 0}var o=r(55),i=r(59);t.exports=n},function(t,e,r){"use strict";function n(t){if(!u(t)||i(t))return!1;var e=o(t)?d:c;return e.test(a(t))}var o=r(16),i=r(56),u=r(8),a=r(58),s=/[\\^$.*+?()[\]{}|]/g,c=/^\[object .+?Constructor\]$/,f=Function.prototype,l=Object.prototype,p=f.toString,h=l.hasOwnProperty,d=RegExp("^"+p.call(h).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=n},function(t,e,r){"use strict";function n(t){return!!i&&i in t}var o=r(57),i=function(){var t=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();t.exports=n},function(t,e,r){"use strict";var n=r(19),o=n["__core-js_shared__"];t.exports=o},function(t,e){"use strict";function r(t){if(null!=t){try{return o.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var n=Function.prototype,o=n.toString;t.exports=r},function(t,e){"use strict";function r(t,e){return null==t?void 0:t[e]}t.exports=r},function(t,e,r){"use strict";var n=r(54),o=r(19),i=n(o,"Map");t.exports=i},function(t,e,r){"use strict";var n=r(54),o=r(19),i=n(o,"Promise");t.exports=i},function(t,e,r){"use strict";var n=r(54),o=r(19),i=n(o,"Set");t.exports=i},function(t,e,r){"use strict";var n=r(54),o=r(19),i=n(o,"WeakMap");t.exports=i},function(t,e,r){"use strict";function n(t,e){var r=[new o.InClauseUnderConjunctionPlugin(t,e)];return i(r.filter(function(t){return t.isMatched()}))}Object.defineProperty(e,"__esModule",{value:!0});var o=r(65),i=r(67);e.getAppropriatePlugin=n},function(t,e,r){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();Object.defineProperty(e,"__esModule",{value:!0});var u=r(6),a=r(66),s=r(67),c=r(31),f=r(34),l=r(68),p=r(101),h=r(51),d=r(105),y=r(10),v=r(107),m=r(4),b=r(108),_="where",g="join",w="key",x="$in",S="$and",k=function(t){return s(c(t))},E=function(t){return s(f(t))},O=function(t){return 1===f(t).length},j=function(){function t(e,r){o(this,t),this.flow={},this.fileReader=r.fileReader,this.datasetPath=r.datasetPath,this.query=e,this.datapackage=r.datapackage}return i(t,[{key:"isMatched",value:function(){this.flow.joinObject=l(this.query,g);var t=l(this.query,_),e=O(t),r=f(this.flow.joinObject),n=!0,o=!0,i=!1,u=void 0;try{for(var a,s=r[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var c=a.value,p=l(this.flow.joinObject,c,{}),h=E(p[_]);if(p[w]!==h&&h!==S){n=!1;break}}}catch(t){i=!0,u=t}finally{try{!o&&s.return&&s.return()}finally{if(i)throw u}}return e&&!!this.flow.joinObject&&n}},{key:"getOptimalFilesSet",value:function(){return u.__awaiter(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isMatched()){t.next=20;break}return e=void 0,t.prev=2,this.fillResourceToFileHash(),this.collectProcessableClauses(),this.collectEntityFilesNames(),t.next=8,this.collectEntities();case 8:r=t.sent,this.fillEntityValuesHash(r),this.getFilesGroupsQueryClause(),e=this.getOptimalFilesGroup(),t.next=17;break;case 14:return t.prev=14,t.t0=t.catch(2),t.abrupt("return",[]);case 17:return t.abrupt("return",e);case 20:throw new m.DdfCsvError('Plugin "InClauseUnderConjunction" is not matched!',"InClauseUnderConjunction plugin");case 21:case"end":return t.stop()}},t,this,[[2,14]])}))}},{key:"fillResourceToFileHash",value:function(){return this.flow.resourceToFile=l(this.datapackage,"resources",[]).reduce(function(t,e){return t.set(e.name,e.path),t},new Map),this}},{key:"collectProcessableClauses",value:function(){var t=this,e=f(this.flow.joinObject);this.flow.processableClauses=[];var r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done);r=!0){var s=u.value,c=l(this.flow.joinObject,s+"."+_,{});if(this.singleAndField(c)){var h;(h=this.flow.processableClauses).push.apply(h,n(p(c[S].map(function(e){return t.getProcessableClauses(e)}))))}else{var d;(d=this.flow.processableClauses).push.apply(d,n(this.getProcessableClauses(c)))}}}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return this}},{key:"collectEntityFilesNames",value:function(){this.flow.entityFilesNames=[],this.flow.fileNameToPrimaryKeyHash=new Map;var t=!0,e=!1,r=void 0;try{for(var n,o=this.datapackage.ddfSchema.entities[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var i=n.value,u=!0,a=!1,c=void 0;try{for(var f,l=this.flow.processableClauses[Symbol.iterator]();!(u=(f=l.next()).done);u=!0){var p=f.value,h=E(p);if(s(i.primaryKey)===h){var d=!0,y=!1,v=void 0;try{for(var m,b=i.resources[Symbol.iterator]();!(d=(m=b.next()).done);d=!0){var _=m.value,g=this.flow.resourceToFile.get(_);this.flow.entityFilesNames.push(g),this.flow.fileNameToPrimaryKeyHash.set(g,h)}}catch(t){y=!0,v=t}finally{try{!d&&b.return&&b.return()}finally{if(y)throw v}}}}}catch(t){a=!0,c=t}finally{try{!u&&l.return&&l.return()}finally{if(a)throw c}}}}catch(t){e=!0,r=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw r}}return this}},{key:"collectEntities",value:function(){var t=this,e=t.flow.entityFilesNames.map(function(e){return new Promise(function(r,n){t.fileReader.readText(a.resolve(t.datasetPath,e),function(t,o){return t?n(t):void b.parse(o,{header:!0,skipEmptyLines:!0,complete:function(t){return r({file:e,result:t})},error:function(t){return n(t)}})})})});return Promise.all(e)}},{key:"fillEntityValuesHash",value:function(t){var e=function(t){return v(f(t).filter(function(e){return d(e,"is--")&&("TRUE"===t[e]||"true"===t[e])}).map(function(t){return t.replace(/^is--/,"")}))};this.flow.entityValueToFileHash=new Map,this.flow.entityValueToDomainHash=new Map;var r=!0,o=!1,i=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done);r=!0){var s=u.value,c=!0,l=!1,p=void 0;try{for(var y,m=s.result.data[Symbol.iterator]();!(c=(y=m.next()).done);c=!0){var b=y.value,_=this.flow.fileNameToPrimaryKeyHash.get(s.file),g=b[_],w=[].concat(n(e(b)));h(w)&&w.push(_),this.flow.entityValueToDomainHash.set(g,w),this.flow.entityValueToFileHash.set(g,s.file)}}catch(t){l=!0,p=t}finally{try{!c&&m.return&&m.return()}finally{if(l)throw p}}}}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return this}},{key:"getFilesGroupsQueryClause",value:function(){var t=new Map,e=!0,r=!1,n=void 0;try{for(var o,i=this.flow.processableClauses[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var u=o.value,a={entities:new Set,datapoints:new Set,concepts:new Set},s=k(u).$in,c=!0,f=!1,l=void 0;try{for(var p,h=s[Symbol.iterator]();!(c=(p=h.next()).done);c=!0){var d=p.value;a.entities.add(this.flow.entityValueToFileHash.get(d));var v=this.flow.entityValueToDomainHash.get(d),m=!0,b=!1,_=void 0;try{for(var g,w=v[Symbol.iterator]();!(m=(g=w.next()).done);m=!0){var x=g.value,S=!0,E=!1,O=void 0;try{for(var j,A=this.datapackage.ddfSchema.datapoints[Symbol.iterator]();!(S=(j=A.next()).done);S=!0){var R=j.value,C=!0,T=!1,P=void 0;try{for(var D,I=R.resources[Symbol.iterator]();!(C=(D=I.next()).done);C=!0){var L=D.value;y(R.primaryKey,x)&&a.datapoints.add(this.flow.resourceToFile.get(L))}}catch(t){T=!0,P=t}finally{try{!C&&I.return&&I.return()}finally{if(T)throw P}}}}catch(t){E=!0,O=t}finally{try{!S&&A.return&&A.return()}finally{if(E)throw O}}}}catch(t){b=!0,_=t}finally{try{!m&&w.return&&w.return()}finally{if(b)throw _}}}}catch(t){f=!0,l=t}finally{try{!c&&h.return&&h.return()}finally{if(f)throw l}}var F=!0,M=!1,N=void 0;try{for(var $,z=this.datapackage.ddfSchema.concepts[Symbol.iterator]();!(F=($=z.next()).done);F=!0){var U=$.value,B=!0,q=!1,Q=void 0;try{for(var H,V=U.resources[Symbol.iterator]();!(B=(H=V.next()).done);B=!0){var G=H.value;a.concepts.add(this.flow.resourceToFile.get(G))}}catch(t){q=!0,Q=t}finally{try{!B&&V.return&&V.return()}finally{if(q)throw Q}}}}catch(t){M=!0,N=t}finally{try{!F&&z.return&&z.return()}finally{if(M)throw N}}t.set(u,a)}}catch(t){r=!0,n=t}finally{try{!e&&i.return&&i.return()}finally{if(r)throw n}}return this.flow.filesGroupsByClause=t,this}},{key:"getOptimalFilesGroup",value:function(){var t=this.flow.filesGroupsByClause.keys(),e=void 0,r=void 0,o=!0,i=!1,u=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var c=a.value,f=this.flow.filesGroupsByClause.get(c).datapoints.size+this.flow.filesGroupsByClause.get(c).entities.size+this.flow.filesGroupsByClause.get(c).concepts.size;(!e||f<r)&&(e=c,r=f)}}catch(t){i=!0,u=t}finally{try{!o&&s.return&&s.return()}finally{if(i)throw u}}return[].concat(n(Array.from(this.flow.filesGroupsByClause.get(e).concepts)),n(Array.from(this.flow.filesGroupsByClause.get(e).entities)),n(Array.from(this.flow.filesGroupsByClause.get(e).datapoints)))}},{key:"getProcessableClauses",value:function(t){var e=[],r=f(t),n=!0,o=!1,i=void 0;try{for(var u,a=r[Symbol.iterator]();!(n=(u=a.next()).done);n=!0){var c=u.value;if(!d(c,"$")&&O(t[c])){var l=s(f(t[c]));l===x&&e.push(t)}}}catch(t){o=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(o)throw i}}return e}},{key:"singleAndField",value:function(t){return O(t)&&!!l(t,S)}}]),t}();e.InClauseUnderConjunctionPlugin=j},function(t,e){t.exports=require("path")},function(t,e){"use strict";function r(t){return t&&t.length?t[0]:void 0}t.exports=r},function(t,e,r){"use strict";function n(t,e,r){var n=null==t?void 0:o(t,e);return void 0===n?r:n}var o=r(69);t.exports=n},function(t,e,r){"use strict";function n(t,e){e=o(e,t);for(var r=0,n=e.length;null!=t&&r<n;)t=t[i(e[r++])];return r&&r==n?t:void 0}var o=r(70),i=r(100);t.exports=n},function(t,e,r){"use strict";function n(t,e){return o(t)?t:i(t,e)?[t]:u(a(t))}var o=r(25),i=r(71),u=r(72),a=r(98);t.exports=n},function(t,e,r){"use strict";function n(t,e){if(i(t))return!1;var r="undefined"==typeof t?"undefined":o(t);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!u(t))||(s.test(t)||!a.test(t)||null!=e&&t in Object(e))}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=r(25),u=r(30),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;t.exports=n},function(t,e,r){"use strict";var n=r(73),o=/^\./,i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,u=/\\(\\)?/g,a=n(function(t){var e=[];return o.test(t)&&e.push(""),t.replace(i,function(t,r,n,o){e.push(n?o.replace(u,"$1"):r||t)}),e});t.exports=a},function(t,e,r){"use strict";function n(t){var e=o(t,function(t){return r.size===i&&r.clear(),t}),r=e.cache;return e}var o=r(74),i=500;t.exports=n},function(t,e,r){"use strict";function n(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(i);var r=function r(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var u=t.apply(this,n);return r.cache=i.set(o,u)||i,u};return r.cache=new(n.Cache||o),r}var o=r(75),i="Expected a function";n.Cache=o,t.exports=n},function(t,e,r){"use strict";function n(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}var o=r(76),i=r(92),u=r(95),a=r(96),s=r(97);n.prototype.clear=o,n.prototype.delete=i,n.prototype.get=u,n.prototype.has=a,n.prototype.set=s,t.exports=n},function(t,e,r){"use strict";function n(){this.size=0,this.__data__={hash:new o,map:new(u||i),string:new o}}var o=r(77),i=r(84),u=r(60);t.exports=n},function(t,e,r){"use strict";function n(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}var o=r(78),i=r(80),u=r(81),a=r(82),s=r(83);n.prototype.clear=o,n.prototype.delete=i,n.prototype.get=u,n.prototype.has=a,n.prototype.set=s,t.exports=n},function(t,e,r){"use strict";function n(){this.__data__=o?o(null):{},this.size=0}var o=r(79);t.exports=n},function(t,e,r){"use strict";var n=r(54),o=n(Object,"create");t.exports=o},function(t,e){"use strict";function r(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}t.exports=r},function(t,e,r){"use strict";function n(t){var e=this.__data__;if(o){var r=e[t];return r===i?void 0:r}return a.call(e,t)?e[t]:void 0}var o=r(79),i="__lodash_hash_undefined__",u=Object.prototype,a=u.hasOwnProperty;t.exports=n},function(t,e,r){"use strict";function n(t){var e=this.__data__;return o?void 0!==e[t]:u.call(e,t)}var o=r(79),i=Object.prototype,u=i.hasOwnProperty;t.exports=n},function(t,e,r){"use strict";function n(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=o&&void 0===e?i:e,this}var o=r(79),i="__lodash_hash_undefined__";t.exports=n},function(t,e,r){"use strict";function n(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}var o=r(85),i=r(86),u=r(89),a=r(90),s=r(91);n.prototype.clear=o,n.prototype.delete=i,n.prototype.get=u,n.prototype.has=a,n.prototype.set=s,t.exports=n},function(t,e){"use strict";function r(){this.__data__=[],this.size=0}t.exports=r},function(t,e,r){"use strict";function n(t){var e=this.__data__,r=o(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():u.call(e,r,1),--this.size,!0}var o=r(87),i=Array.prototype,u=i.splice;t.exports=n},function(t,e,r){"use strict";function n(t,e){for(var r=t.length;r--;)if(o(t[r][0],e))return r;return-1}var o=r(88);t.exports=n},function(t,e){"use strict";function r(t,e){return t===e||t!==t&&e!==e}t.exports=r},function(t,e,r){"use strict";function n(t){var e=this.__data__,r=o(e,t);return r<0?void 0:e[r][1]}var o=r(87);t.exports=n},function(t,e,r){"use strict";function n(t){return o(this.__data__,t)>-1}var o=r(87);t.exports=n},function(t,e,r){"use strict";function n(t,e){var r=this.__data__,n=o(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}var o=r(87);t.exports=n},function(t,e,r){"use strict";function n(t){var e=o(this,t).delete(t);return this.size-=e?1:0,e}var o=r(93);t.exports=n},function(t,e,r){"use strict";function n(t,e){var r=t.__data__;return o(e)?r["string"==typeof e?"string":"hash"]:r.map}var o=r(94);t.exports=n},function(t,e){"use strict";function r(t){var e="undefined"==typeof t?"undefined":n(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=r},function(t,e,r){"use strict";function n(t){return o(this,t).get(t)}var o=r(93);t.exports=n},function(t,e,r){"use strict";function n(t){return o(this,t).has(t)}var o=r(93);t.exports=n},function(t,e,r){"use strict";function n(t,e){var r=o(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}var o=r(93);t.exports=n},function(t,e,r){"use strict";function n(t){return null==t?"":o(t)}var o=r(99);t.exports=n},function(t,e,r){"use strict";function n(t){if("string"==typeof t)return t;if(u(t))return i(t,n)+"";if(a(t))return f?f.call(t):"";var e=t+"";return"0"==e&&1/t==-s?"-0":e}var o=r(18),i=r(33),u=r(25),a=r(30),s=1/0,c=o?o.prototype:void 0,f=c?c.toString:void 0;t.exports=n},function(t,e,r){"use strict";function n(t){if("string"==typeof t||o(t))return t;var e=t+"";return"0"==e&&1/t==-i?"-0":e}var o=r(30),i=1/0;t.exports=n},function(t,e,r){"use strict";function n(t){var e=null==t?0:t.length;return e?o(t,i):[]}var o=r(102),i=1/0;t.exports=n},function(t,e,r){"use strict";function n(t,e,r,u,a){var s=-1,c=t.length;for(r||(r=i),a||(a=[]);++s<c;){var f=t[s];e>0&&r(f)?e>1?n(f,e-1,r,u,a):o(a,f):u||(a[a.length]=f)}return a}var o=r(103),i=r(104);t.exports=n},function(t,e){"use strict";function r(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}t.exports=r},function(t,e,r){"use strict";function n(t){return u(t)||i(t)||!!(a&&t&&t[a])}var o=r(18),i=r(37),u=r(25),a=o?o.isConcatSpreadable:void 0;t.exports=n},function(t,e,r){"use strict";function n(t,e,r){return t=a(t),r=null==r?0:o(u(r),0,t.length),e=i(e),t.slice(r,r+e.length)==e}var o=r(106),i=r(99),u=r(27),a=r(98);t.exports=n},function(t,e){"use strict";function r(t,e,r){return t===t&&(void 0!==r&&(t=t<=r?t:r),void 0!==e&&(t=t>=e?t:e)),t}t.exports=r},function(t,e){"use strict";function r(t){for(var e=-1,r=null==t?0:t.length,n=0,o=[];++e<r;){var i=t[e];i&&(o[n++]=i)}return o}t.exports=r},function(t,e,r){var n,o,i,u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};/*!
		Papa Parse
		v4.3.6
		https://github.com/mholt/PapaParse
		License: MIT
	*/
!function(r,u){o=[],n=u,i="function"==typeof n?n.apply(e,o):n,!(void 0!==i&&(t.exports=i))}(void 0,function(){"use strict";function t(t,e){e=e||{};var r=e.dynamicTyping||!1;if(b(r)&&(e.dynamicTypingFunction=r,r={}),e.dynamicTyping=r,e.worker&&O.WORKERS_SUPPORTED){var u=l();return u.userStep=e.step,u.userChunk=e.chunk,u.userComplete=e.complete,u.userError=e.error,e.step=b(e.step),e.chunk=b(e.chunk),e.complete=b(e.complete),e.error=b(e.error),delete e.worker,void u.postMessage({input:t,config:e,workerId:u.id})}var s=null;return"string"==typeof t?s=e.download?new n(e):new i(e):t.readable===!0&&b(t.read)&&b(t.on)?s=new a(e):(g.File&&t instanceof File||t instanceof Object)&&(s=new o(e)),s.stream(t)}function e(t,e){function r(){"object"===("undefined"==typeof e?"undefined":u(e))&&("string"==typeof e.delimiter&&1===e.delimiter.length&&O.BAD_DELIMITERS.indexOf(e.delimiter)===-1&&(f=e.delimiter),("boolean"==typeof e.quotes||e.quotes instanceof Array)&&(s=e.quotes),"string"==typeof e.newline&&(l=e.newline),"string"==typeof e.quoteChar&&(p=e.quoteChar),"boolean"==typeof e.header&&(c=e.header))}function n(t){if("object"!==("undefined"==typeof t?"undefined":u(t)))return[];var e=[];for(var r in t)e.push(r);return e}function o(t,e){var r="";"string"==typeof t&&(t=JSON.parse(t)),"string"==typeof e&&(e=JSON.parse(e));var n=t instanceof Array&&t.length>0,o=!(e[0]instanceof Array);if(n&&c){for(var u=0;u<t.length;u++)u>0&&(r+=f),r+=i(t[u],u);e.length>0&&(r+=l)}for(var a=0;a<e.length;a++){for(var s=n?t.length:e[a].length,p=0;p<s;p++){p>0&&(r+=f);var h=n&&o?t[p]:p;r+=i(e[a][h],p)}a<e.length-1&&(r+=l)}return r}function i(t,e){if("undefined"==typeof t||null===t)return"";t=t.toString().replace(h,p+p);var r="boolean"==typeof s&&s||s instanceof Array&&s[e]||a(t,O.BAD_DELIMITERS)||t.indexOf(f)>-1||" "===t.charAt(0)||" "===t.charAt(t.length-1);return r?p+t+p:t}function a(t,e){for(var r=0;r<e.length;r++)if(t.indexOf(e[r])>-1)return!0;return!1}var s=!1,c=!0,f=",",l="\r\n",p='"';r();var h=new RegExp(p,"g");if("string"==typeof t&&(t=JSON.parse(t)),t instanceof Array){if(!t.length||t[0]instanceof Array)return o(null,t);if("object"===u(t[0]))return o(n(t[0]),t)}else if("object"===("undefined"==typeof t?"undefined":u(t)))return"string"==typeof t.data&&(t.data=JSON.parse(t.data)),t.data instanceof Array&&(t.fields||(t.fields=t.meta&&t.meta.fields),t.fields||(t.fields=t.data[0]instanceof Array?t.fields:n(t.data[0])),t.data[0]instanceof Array||"object"===u(t.data[0])||(t.data=[t.data])),o(t.fields||[],t.data||[]);throw"exception: Unable to serialize unrecognized input"}function r(t){function e(t){var e=v(t);e.chunkSize=parseInt(e.chunkSize),t.step||t.chunk||(e.chunkSize=null),this._handle=new s(e),this._handle.streamer=this,this._config=e}this._handle=null,this._paused=!1,this._finished=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},e.call(this,t),this.parseChunk=function(t){if(this.isFirstChunk&&b(this._config.beforeFirstChunk)){var e=this._config.beforeFirstChunk(t);void 0!==e&&(t=e)}this.isFirstChunk=!1;var r=this._partialLine+t;this._partialLine="";var n=this._handle.parse(r,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var o=n.meta.cursor;this._finished||(this._partialLine=r.substring(o-this._baseIndex),this._baseIndex=o),n&&n.data&&(this._rowCount+=n.data.length);var i=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(x)g.postMessage({results:n,workerId:O.WORKER_ID,finished:i});else if(b(this._config.chunk)){if(this._config.chunk(n,this._handle),this._paused)return;n=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(n.data),this._completeResults.errors=this._completeResults.errors.concat(n.errors),this._completeResults.meta=n.meta),!i||!b(this._config.complete)||n&&n.meta.aborted||this._config.complete(this._completeResults,this._input),i||n&&n.meta.paused||this._nextChunk(),n}},this._sendError=function(t){b(this._config.error)?this._config.error(t):x&&this._config.error&&g.postMessage({workerId:O.WORKER_ID,error:t,finished:!1})}}function n(t){function e(t){var e=t.getResponseHeader("Content-Range");return null===e?-1:parseInt(e.substr(e.lastIndexOf("/")+1))}t=t||{},t.chunkSize||(t.chunkSize=O.RemoteChunkSize),r.call(this,t);var n;w?this._nextChunk=function(){this._readChunk(),this._chunkLoaded()}:this._nextChunk=function(){this._readChunk()},this.stream=function(t){this._input=t,this._nextChunk()},this._readChunk=function(){if(this._finished)return void this._chunkLoaded();if(n=new XMLHttpRequest,this._config.withCredentials&&(n.withCredentials=this._config.withCredentials),w||(n.onload=m(this._chunkLoaded,this),n.onerror=m(this._chunkError,this)),n.open("GET",this._input,!w),this._config.downloadRequestHeaders){var t=this._config.downloadRequestHeaders;for(var e in t)n.setRequestHeader(e,t[e])}if(this._config.chunkSize){var r=this._start+this._config.chunkSize-1;n.setRequestHeader("Range","bytes="+this._start+"-"+r),n.setRequestHeader("If-None-Match","webkit-no-cache")}try{n.send()}catch(t){this._chunkError(t.message)}w&&0===n.status?this._chunkError():this._start+=this._config.chunkSize},this._chunkLoaded=function(){if(4==n.readyState){if(n.status<200||n.status>=400)return void this._chunkError();this._finished=!this._config.chunkSize||this._start>e(n),this.parseChunk(n.responseText)}},this._chunkError=function(t){var e=n.statusText||t;this._sendError(e)}}function o(t){t=t||{},t.chunkSize||(t.chunkSize=O.LocalChunkSize),r.call(this,t);var e,n,o="undefined"!=typeof FileReader;this.stream=function(t){this._input=t,n=t.slice||t.webkitSlice||t.mozSlice,o?(e=new FileReader,e.onload=m(this._chunkLoaded,this),e.onerror=m(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var t=this._input;if(this._config.chunkSize){var r=Math.min(this._start+this._config.chunkSize,this._input.size);t=n.call(t,this._start,r)}var i=e.readAsText(t,this._config.encoding);o||this._chunkLoaded({target:{result:i}})},this._chunkLoaded=function(t){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(t.target.result)},this._chunkError=function(){this._sendError(e.error)}}function i(t){t=t||{},r.call(this,t);var e,n;this.stream=function(t){return e=t,n=t,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var t=this._config.chunkSize,e=t?n.substr(0,t):n;return n=t?n.substr(t):"",this._finished=!n,this.parseChunk(e)}}}function a(t){t=t||{},r.call(this,t);var e=[],n=!0;this.stream=function(t){this._input=t,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._nextChunk=function(){e.length?this.parseChunk(e.shift()):n=!0},this._streamData=m(function(t){try{e.push("string"==typeof t?t:t.toString(this._config.encoding)),n&&(n=!1,this.parseChunk(e.shift()))}catch(t){this._streamError(t)}},this),this._streamError=m(function(t){this._streamCleanUp(),this._sendError(t.message)},this),this._streamEnd=m(function(){this._streamCleanUp(),this._finished=!0,this._streamData("")},this),this._streamCleanUp=m(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function s(t){function e(){if(S&&d&&(l("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+O.DefaultDelimiter+"'"),d=!1),t.skipEmptyLines)for(var e=0;e<S.data.length;e++)1===S.data[e].length&&""===S.data[e][0]&&S.data.splice(e--,1);return r()&&n(),u()}function r(){return t.header&&0===x.length}function n(){if(S){for(var t=0;r()&&t<S.data.length;t++)for(var e=0;e<S.data[t].length;e++)x.push(S.data[t][e]);S.data.splice(0,1)}}function o(e){return t.dynamicTypingFunction&&void 0===t.dynamicTyping[e]&&(t.dynamicTyping[e]=t.dynamicTypingFunction(e)),(t.dynamicTyping[e]||t.dynamicTyping)===!0}function i(t,e){return o(t)?"true"===e||"TRUE"===e||"false"!==e&&"FALSE"!==e&&f(e):e}function u(){if(!S||!t.header&&!t.dynamicTyping)return S;for(var e=0;e<S.data.length;e++){for(var r=t.header?{}:[],n=0;n<S.data[e].length;n++){var o=n,u=S.data[e][n];t.header&&(o=n>=x.length?"__parsed_extra":x[n]),u=i(o,u),"__parsed_extra"===o?(r[o]=r[o]||[],r[o].push(u)):r[o]=u}S.data[e]=r,t.header&&(n>x.length?l("FieldMismatch","TooManyFields","Too many fields: expected "+x.length+" fields but parsed "+n,e):n<x.length&&l("FieldMismatch","TooFewFields","Too few fields: expected "+x.length+" fields but parsed "+n,e))}return t.header&&S.meta&&(S.meta.fields=x),S}function a(e,r,n){for(var o,i,u,a=[",","\t","|",";",O.RECORD_SEP,O.UNIT_SEP],s=0;s<a.length;s++){var f=a[s],l=0,p=0,h=0;u=void 0;for(var d=new c({delimiter:f,newline:r,preview:10}).parse(e),y=0;y<d.data.length;y++)if(n&&1===d.data[y].length&&0===d.data[y][0].length)h++;else{var v=d.data[y].length;p+=v,"undefined"!=typeof u?v>1&&(l+=Math.abs(v-u),u=v):u=v}d.data.length>0&&(p/=d.data.length-h),("undefined"==typeof i||l<i)&&p>1.99&&(i=l,o=f)}return t.delimiter=o,{successful:!!o,bestDelimiter:o}}function s(t){t=t.substr(0,1048576);var e=t.split("\r"),r=t.split("\n"),n=r.length>1&&r[0].length<e[0].length;if(1===e.length||n)return"\n";for(var o=0,i=0;i<e.length;i++)"\n"===e[i][0]&&o++;return o>=e.length/2?"\r\n":"\r"}function f(t){var e=y.test(t);return e?parseFloat(t):t}function l(t,e,r,n){S.errors.push({type:t,code:e,message:r,row:n})}var p,h,d,y=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,m=this,_=0,g=!1,w=!1,x=[],S={data:[],errors:[],meta:{}};if(b(t.step)){var k=t.step;t.step=function(n){if(S=n,r())e();else{if(e(),0===S.data.length)return;_+=n.data.length,t.preview&&_>t.preview?h.abort():k(S,m)}}}this.parse=function(r,n,o){if(t.newline||(t.newline=s(r)),d=!1,t.delimiter)b(t.delimiter)&&(t.delimiter=t.delimiter(r),S.meta.delimiter=t.delimiter);else{var i=a(r,t.newline,t.skipEmptyLines);i.successful?t.delimiter=i.bestDelimiter:(d=!0,t.delimiter=O.DefaultDelimiter),S.meta.delimiter=t.delimiter}var u=v(t);return t.preview&&t.header&&u.preview++,p=r,h=new c(u),S=h.parse(p,n,o),e(),g?{meta:{paused:!0}}:S||{meta:{paused:!1}}},this.paused=function(){return g},this.pause=function(){g=!0,h.abort(),p=p.substr(h.getCharIndex())},this.resume=function(){g=!1,m.streamer.parseChunk(p)},this.aborted=function(){return w},this.abort=function(){w=!0,h.abort(),S.meta.aborted=!0,b(t.complete)&&t.complete(S),p=""}}function c(t){t=t||{};var e=t.delimiter,r=t.newline,n=t.comments,o=t.step,i=t.preview,u=t.fastMode,a=t.quoteChar||'"';if(("string"!=typeof e||O.BAD_DELIMITERS.indexOf(e)>-1)&&(e=","),n===e)throw"Comment character same as delimiter";n===!0?n="#":("string"!=typeof n||O.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),"\n"!=r&&"\r"!=r&&"\r\n"!=r&&(r="\n");var s=0,c=!1;this.parse=function(t,f,l){function p(t){S.push(t),O=s}function h(e){return l?y():("undefined"==typeof e&&(e=t.substr(s)),E.push(e),s=m,p(E),x&&v(),y())}function d(e){s=e,p(E),E=[],C=t.indexOf(r,s)}function y(t){return{data:S,errors:k,meta:{delimiter:e,linebreak:r,aborted:c,truncated:!!t,cursor:O+(f||0)}}}function v(){o(y()),S=[],k=[]}if("string"!=typeof t)throw"Input must be a string";var m=t.length,_=e.length,g=r.length,w=n.length,x=b(o);s=0;var S=[],k=[],E=[],O=0;if(!t)return y();if(u||u!==!1&&t.indexOf(a)===-1){for(var j=t.split(r),A=0;A<j.length;A++){var E=j[A];if(s+=E.length,A!==j.length-1)s+=r.length;else if(l)return y();if(!n||E.substr(0,w)!==n){if(x){if(S=[],p(E.split(e)),v(),c)return y()}else p(E.split(e));if(i&&A>=i)return S=S.slice(0,i),y(!0)}}return y()}for(var R=t.indexOf(e,s),C=t.indexOf(r,s),T=new RegExp(a+a,"g");;)if(t[s]!==a)if(n&&0===E.length&&t.substr(s,w)===n){if(C===-1)return y();s=C+g,C=t.indexOf(r,s),R=t.indexOf(e,s)}else if(R!==-1&&(R<C||C===-1))E.push(t.substring(s,R)),s=R+_,R=t.indexOf(e,s);else{if(C===-1)break;if(E.push(t.substring(s,C)),d(C+g),x&&(v(),c))return y();if(i&&S.length>=i)return y(!0)}else{var P=s;for(s++;;){var P=t.indexOf(a,P+1);if(P===-1)return l||k.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:S.length,index:s}),h();if(P===m-1){var D=t.substring(s,P).replace(T,a);return h(D)}if(t[P+1]!==a){if(t[P+1]===e){E.push(t.substring(s,P).replace(T,a)),s=P+1+_,R=t.indexOf(e,s),C=t.indexOf(r,s);break}if(t.substr(P+1,g)===r){if(E.push(t.substring(s,P).replace(T,a)),d(P+1+g),R=t.indexOf(e,s),x&&(v(),c))return y();if(i&&S.length>=i)return y(!0);break}k.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:S.length,index:s}),P++}else P++}}return h()},this.abort=function(){c=!0},this.getCharIndex=function(){return s}}function f(){var t=document.getElementsByTagName("script");return t.length?t[t.length-1].src:""}function l(){if(!O.WORKERS_SUPPORTED)return!1;if(!S&&null===O.SCRIPT_PATH)throw new Error("Script path cannot be determined automatically when Papa Parse is loaded asynchronously. You need to set Papa.SCRIPT_PATH manually.");var t=O.SCRIPT_PATH||_;t+=(t.indexOf("?")!==-1?"&":"?")+"papaworker";var e=new g.Worker(t);return e.onmessage=p,e.id=E++,k[e.id]=e,e}function p(t){var e=t.data,r=k[e.workerId],n=!1;if(e.error)r.userError(e.error,e.file);else if(e.results&&e.results.data){var o=function(){n=!0,h(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},i={abort:o,pause:d,resume:d};if(b(r.userStep)){for(var u=0;u<e.results.data.length&&(r.userStep({data:[e.results.data[u]],errors:e.results.errors,meta:e.results.meta},i),!n);u++);delete e.results}else b(r.userChunk)&&(r.userChunk(e.results,i,e.file),delete e.results)}e.finished&&!n&&h(e.workerId,e.results)}function h(t,e){var r=k[t];b(r.userComplete)&&r.userComplete(e),r.terminate(),delete k[t]}function d(){throw"Not implemented."}function y(t){var e=t.data;if("undefined"==typeof O.WORKER_ID&&e&&(O.WORKER_ID=e.workerId),"string"==typeof e.input)g.postMessage({workerId:O.WORKER_ID,results:O.parse(e.input,e.config),finished:!0});else if(g.File&&e.input instanceof File||e.input instanceof Object){var r=O.parse(e.input,e.config);r&&g.postMessage({workerId:O.WORKER_ID,results:r,finished:!0})}}function v(t){if("object"!==("undefined"==typeof t?"undefined":u(t)))return t;var e=t instanceof Array?[]:{};for(var r in t)e[r]=v(t[r]);return e}function m(t,e){return function(){t.apply(e,arguments)}}function b(t){return"function"==typeof t}var _,g=function(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof g?g:{}}(),w=!g.document&&!!g.postMessage,x=w&&/(\?|&)papaworker(=|&|$)/.test(g.location.search),S=!1,k={},E=0,O={};if(O.parse=t,O.unparse=e,O.RECORD_SEP=String.fromCharCode(30),O.UNIT_SEP=String.fromCharCode(31),O.BYTE_ORDER_MARK="\ufeff",O.BAD_DELIMITERS=["\r","\n",'"',O.BYTE_ORDER_MARK],O.WORKERS_SUPPORTED=!w&&!!g.Worker,O.SCRIPT_PATH=null,O.LocalChunkSize=10485760,O.RemoteChunkSize=5242880,O.DefaultDelimiter=",",O.Parser=c,O.ParserHandle=s,O.NetworkStreamer=n,O.FileStreamer=o,O.StringStreamer=i,O.ReadableStreamStreamer=a,g.jQuery){var j=g.jQuery;j.fn.parse=function(t){function e(){if(0===i.length)return void(b(t.complete)&&t.complete());var e=i[0];if(b(t.before)){var o=t.before(e.file,e.inputElem);if("object"===("undefined"==typeof o?"undefined":u(o))){if("abort"===o.action)return void r("AbortError",e.file,e.inputElem,o.reason);if("skip"===o.action)return void n();"object"===u(o.config)&&(e.instanceConfig=j.extend(e.instanceConfig,o.config))}else if("skip"===o)return void n()}var a=e.instanceConfig.complete;e.instanceConfig.complete=function(t){b(a)&&a(t,e.file,e.inputElem),n()},O.parse(e.file,e.instanceConfig)}function r(e,r,n,o){b(t.error)&&t.error({name:e},r,n,o)}function n(){i.splice(0,1),e()}var o=t.config||{},i=[];return this.each(function(t){var e="INPUT"===j(this).prop("tagName").toUpperCase()&&"file"===j(this).attr("type").toLowerCase()&&g.FileReader;if(!e||!this.files||0===this.files.length)return!0;for(var r=0;r<this.files.length;r++)i.push({file:this.files[r],inputElem:this,instanceConfig:j.extend({},o)})}),e(),this}}return x?g.onmessage=y:O.WORKERS_SUPPORTED&&(_=f(),document.body?document.addEventListener("DOMContentLoaded",function(){S=!0},!0):S=!0),n.prototype=Object.create(r.prototype),n.prototype.constructor=n,o.prototype=Object.create(r.prototype),o.prototype.constructor=o,i.prototype=Object.create(i.prototype),i.prototype.constructor=i,a.prototype=Object.create(r.prototype),a.prototype.constructor=a,O})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(6);n.__exportStar(r(110),e),n.__exportStar(r(111),e),n.__exportStar(r(157),e),n.__exportStar(r(171),e)},function(t,e,r){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function o(t){var r=f(t,"from");return e.SCHEMAS.has(r)}function i(t){var r=f(t,"from");return r===e.DATAPOINTS}function u(t){var r=f(t,"from");return r===e.ENTITIES}function a(t){var r=f(t,"from");return r===e.CONCEPTS}function s(t){return l(["entity_domain","entity_set","time"],t)}function c(t){return l(["measure","string"],t)}Object.defineProperty(e,"__esModule",{value:!0});var f=r(68),l=r(10);e.SCHEMAS=new Set(["concepts.schema","entities.schema","datapoints.schema","*.schema"]),e.DATAPOINTS="datapoints",e.ENTITIES="entities",e.CONCEPTS="concepts",e.AVAILABLE_QUERY_OPERATORS=new Set(["$eq","$gt","$gte","$lt","$lte","$ne","$in","$nin","$or","$and","$not","$nor","$size","$all","$elemMatch"]),e.AVAILABLE_FROM_CLAUSE_VALUES=new Set([e.CONCEPTS,e.ENTITIES,e.DATAPOINTS].concat(n(e.SCHEMAS))),e.AVAILABLE_ORDER_BY_CLAUSE_VALUES=new Set(["asc","desc",1,-1]),e.DEFAULT_DATASET_NAME=process.env.DEFAULT_DATASET_NAME||"systema_globalis",e.DEFAULT_DATASET_BRANCH=process.env.DEFAULT_DATASET_BRANCH||"master",e.DEFAULT_DATASET_COMMIT="HEAD",e.DEFAULT_DATASET_DIR=process.env.DEFAULT_DATASET_DIR||"./datasets",e.MAX_AMOUNT_OF_MEASURES_IN_SELECT=5,e.isSchemaQuery=o,e.isDatapointsQuery=i,e.isEntitiesQuery=u,e.isConceptsQuery=a,e.isEntityDomainOrSet=s,e.isMeasure=c},function(t,e,r){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function o(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(r,o){var u=[].concat(n(i(t,e))),a=f(u);return a?r():o("Too many query definition errors: \n* "+u.join("\n* "))})}function i(t,e){var r=[],n=h(t,"select",null),o=(h(t,"from",null),h(n,"key")),i=h(n,"value");switch(!0){case y.isSchemaQuery(t):r.push.apply(r,[]);break;case y.isEntitiesQuery(t):r.push.apply(r,[]);break;case y.isConceptsQuery(t):r.push.apply(r,[]);break;case y.isDatapointsQuery(t):r.push(u(t,o,e),a(t,i,e))}return d(r)}function u(t,e,r){var n=h(t,"from",null),o=s(e,r);if(!f(o))return"'select.key' clause for '"+n+"' queries contains unavailable item(s): "+o.join(", ")+" [repo: "+t.dataset+"]"}function a(t,e,r){var n=h(t,"from",null),o=c(e,r);if(!f(o))return"'select.value' clause for '"+n+"' queries contains unavailable item(s): "+o.join(", ")+" [repo: "+t.dataset+"]"}function s(t,e){return p(t,function(t){var r=e.conceptsLookup.get(t);return!(!l(r)&&y.isEntityDomainOrSet(r.concept_type))})}function c(t,e){return p(t,function(t){var r=e.conceptsLookup.get(t);return!(!l(r)&&y.isMeasure(r.concept_type))})}Object.defineProperty(e,"__esModule",{value:!0});var f=r(51),l=r(7),p=r(112),h=r(68),d=r(107),y=r(110);e.validateQueryDefinitions=o},function(t,e,r){"use strict";function n(t,e){var r=a(t)?o:i;return r(t,u(e,3))}var o=r(113),i=r(114),u=r(120),a=r(25);t.exports=n},function(t,e){"use strict";function r(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var u=t[r];e(u,r,t)&&(i[o++]=u)}return i}t.exports=r},function(t,e,r){"use strict";function n(t,e){var r=[];return o(t,function(t,n,o){e(t,n,o)&&r.push(t)}),r}var o=r(115);t.exports=n},function(t,e,r){"use strict";var n=r(116),o=r(119),i=o(n);t.exports=i},function(t,e,r){"use strict";function n(t,e){return t&&o(t,e,i)}var o=r(117),i=r(34);t.exports=n},function(t,e,r){"use strict";var n=r(118),o=n();t.exports=o},function(t,e){"use strict";function r(t){return function(e,r,n){for(var o=-1,i=Object(e),u=n(e),a=u.length;a--;){var s=u[t?a:++o];if(r(i[s],s,i)===!1)break}return e}}t.exports=r},function(t,e,r){"use strict";function n(t,e){return function(r,n){if(null==r)return r;if(!o(r))return t(r,n);for(var i=r.length,u=e?i:-1,a=Object(r);(e?u--:++u<i)&&n(a[u],u,a)!==!1;);return r}}var o=r(15);t.exports=n},function(t,e,r){"use strict";function n(t){return"function"==typeof t?t:null==t?a:"object"==("undefined"==typeof t?"undefined":o(t))?s(t)?u(t[0],t[1]):i(t):c(t)}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=r(121),u=r(149),a=r(153),s=r(25),c=r(154);t.exports=n},function(t,e,r){"use strict";function n(t){var e=i(t);return 1==e.length&&e[0][2]?u(e[0][0],e[0][1]):function(r){return r===t||o(r,t,e)}}var o=r(122),i=r(146),u=r(148);t.exports=n},function(t,e,r){"use strict";function n(t,e,r,n){var s=r.length,c=s,f=!n;if(null==t)return!c;for(t=Object(t);s--;){var l=r[s];if(f&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<c;){l=r[s];var p=l[0],h=t[p],d=l[1];if(f&&l[2]){if(void 0===h&&!(p in t))return!1}else{var y=new o;if(n)var v=n(h,d,p,t,e,y);if(!(void 0===v?i(d,h,u|a,n,y):v))return!1}}return!0}var o=r(123),i=r(129),u=1,a=2;t.exports=n},function(t,e,r){"use strict";function n(t){var e=this.__data__=new o(t);this.size=e.size}var o=r(84),i=r(124),u=r(125),a=r(126),s=r(127),c=r(128);n.prototype.clear=i,n.prototype.delete=u,n.prototype.get=a,n.prototype.has=s,n.prototype.set=c,t.exports=n},function(t,e,r){"use strict";function n(){this.__data__=new o,this.size=0}var o=r(84);t.exports=n},function(t,e){"use strict";function r(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}t.exports=r},function(t,e){"use strict";function r(t){return this.__data__.get(t)}t.exports=r},function(t,e){"use strict";function r(t){return this.__data__.has(t)}t.exports=r},function(t,e,r){"use strict";function n(t,e){var r=this.__data__;if(r instanceof o){var n=r.__data__;if(!i||n.length<a-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new u(n)}return r.set(t,e),this.size=r.size,this}var o=r(84),i=r(60),u=r(75),a=200;t.exports=n},function(t,e,r){"use strict";function n(t,e,r,u,a){return t===e||(null==t||null==e||!i(t)&&!i(e)?t!==t&&e!==e:o(t,e,r,u,n,a))}var o=r(130),i=r(26);t.exports=n},function(t,e,r){"use strict";function n(t,e,r,n,v,b){var _=c(t),g=c(e),w=_?d:s(t),x=g?d:s(e);w=w==h?y:w,x=x==h?y:x;var S=w==y,k=x==y,E=w==x;if(E&&f(t)){if(!f(e))return!1;_=!0,S=!1}if(E&&!S)return b||(b=new o),_||l(t)?i(t,e,r,n,v,b):u(t,e,w,r,n,v,b);if(!(r&p)){var O=S&&m.call(t,"__wrapped__"),j=k&&m.call(e,"__wrapped__");if(O||j){var A=O?t.value():t,R=j?e.value():e;return b||(b=new o),v(A,R,r,n,b)}}return!!E&&(b||(b=new o),a(t,e,r,n,v,b))}var o=r(123),i=r(131),u=r(137),a=r(141),s=r(52),c=r(25),f=r(39),l=r(43),p=1,h="[object Arguments]",d="[object Array]",y="[object Object]",v=Object.prototype,m=v.hasOwnProperty;t.exports=n},function(t,e,r){"use strict";function n(t,e,r,n,c,f){var l=r&a,p=t.length,h=e.length;if(p!=h&&!(l&&h>p))return!1;var d=f.get(t);if(d&&f.get(e))return d==e;var y=-1,v=!0,m=r&s?new o:void 0;for(f.set(t,e),f.set(e,t);++y<p;){var b=t[y],_=e[y];if(n)var g=l?n(_,b,y,e,t,f):n(b,_,y,t,e,f);if(void 0!==g){if(g)continue;v=!1;break}if(m){if(!i(e,function(t,e){if(!u(m,e)&&(b===t||c(b,t,r,n,f)))return m.push(e)})){v=!1;break}}else if(b!==_&&!c(b,_,r,n,f)){v=!1;break}}return f.delete(t),f.delete(e),v}var o=r(132),i=r(135),u=r(136),a=1,s=2;t.exports=n},function(t,e,r){"use strict";function n(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new o;++e<r;)this.add(t[e])}var o=r(75),i=r(133),u=r(134);n.prototype.add=n.prototype.push=i,n.prototype.has=u,t.exports=n},function(t,e){"use strict";function r(t){return this.__data__.set(t,n),this}var n="__lodash_hash_undefined__";t.exports=r},function(t,e){"use strict";function r(t){return this.__data__.has(t)}t.exports=r},function(t,e){"use strict";function r(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}t.exports=r},function(t,e){"use strict";function r(t,e){return t.has(e)}t.exports=r},function(t,e,r){"use strict";function n(t,e,r,n,o,S,E){switch(r){case x:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case w:return!(t.byteLength!=e.byteLength||!S(new i(t),new i(e)));case p:case h:case v:return u(+t,+e);case d:return t.name==e.name&&t.message==e.message;case m:case _:return t==e+"";case y:var O=s;case b:var j=n&f;if(O||(O=c),t.size!=e.size&&!j)return!1;var A=E.get(t);if(A)return A==e;n|=l,E.set(t,e);var R=a(O(t),O(e),n,o,S,E);return E.delete(t),R;case g:if(k)return k.call(t)==k.call(e)}return!1}var o=r(18),i=r(138),u=r(88),a=r(131),s=r(139),c=r(140),f=1,l=2,p="[object Boolean]",h="[object Date]",d="[object Error]",y="[object Map]",v="[object Number]",m="[object RegExp]",b="[object Set]",_="[object String]",g="[object Symbol]",w="[object ArrayBuffer]",x="[object DataView]",S=o?o.prototype:void 0,k=S?S.valueOf:void 0;t.exports=n},function(t,e,r){"use strict";var n=r(19),o=n.Uint8Array;t.exports=o},function(t,e){"use strict";function r(t){var e=-1,r=Array(t.size);return t.forEach(function(t,n){r[++e]=[n,t]}),r}t.exports=r},function(t,e){"use strict";function r(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}t.exports=r},function(t,e,r){"use strict";function n(t,e,r,n,u,s){var c=r&i,f=o(t),l=f.length,p=o(e),h=p.length;if(l!=h&&!c)return!1;for(var d=l;d--;){var y=f[d];if(!(c?y in e:a.call(e,y)))return!1}var v=s.get(t);if(v&&s.get(e))return v==e;var m=!0;s.set(t,e),s.set(e,t);for(var b=c;++d<l;){y=f[d];var _=t[y],g=e[y];if(n)var w=c?n(g,_,y,e,t,s):n(_,g,y,t,e,s);if(!(void 0===w?_===g||u(_,g,r,n,s):w)){m=!1;break}b||(b="constructor"==y)}if(m&&!b){var x=t.constructor,S=e.constructor;x!=S&&"constructor"in t&&"constructor"in e&&!("function"==typeof x&&x instanceof x&&"function"==typeof S&&S instanceof S)&&(m=!1)}return s.delete(t),s.delete(e),m}var o=r(142),i=1,u=Object.prototype,a=u.hasOwnProperty;t.exports=n},function(t,e,r){"use strict";function n(t){return o(t,u,i)}var o=r(143),i=r(144),u=r(34);t.exports=n},function(t,e,r){"use strict";function n(t,e,r){var n=e(t);return i(t)?n:o(n,r(t))}var o=r(103),i=r(25);t.exports=n},function(t,e,r){"use strict";var n=r(113),o=r(145),i=Object.prototype,u=i.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(t){return null==t?[]:(t=Object(t),n(a(t),function(e){return u.call(t,e)}))}:o;t.exports=s},function(t,e){"use strict";function r(){return[]}t.exports=r},function(t,e,r){"use strict";function n(t){for(var e=i(t),r=e.length;r--;){var n=e[r],u=t[n];e[r]=[n,u,o(u)]}return e}var o=r(147),i=r(34);t.exports=n},function(t,e,r){"use strict";function n(t){return t===t&&!o(t)}var o=r(8);t.exports=n},function(t,e){"use strict";function r(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}}t.exports=r},function(t,e,r){"use strict";function n(t,e){return a(t)&&s(e)?c(f(t),e):function(r){var n=i(r,t);return void 0===n&&n===e?u(r,t):o(e,n,l|p)}}var o=r(129),i=r(68),u=r(150),a=r(71),s=r(147),c=r(148),f=r(100),l=1,p=2;t.exports=n},function(t,e,r){"use strict";function n(t,e){return null!=t&&i(t,e,o)}var o=r(151),i=r(152);t.exports=n},function(t,e){"use strict";function r(t,e){return null!=t&&e in Object(t)}t.exports=r},function(t,e,r){"use strict";function n(t,e,r){e=o(e,t);for(var n=-1,f=e.length,l=!1;++n<f;){var p=c(e[n]);if(!(l=null!=t&&r(t,p)))break;t=t[p]}return l||++n!=f?l:(f=null==t?0:t.length,!!f&&s(f)&&a(p,f)&&(u(t)||i(t)))}var o=r(70),i=r(37),u=r(25),a=r(42),s=r(23),c=r(100);t.exports=n},function(t,e){"use strict";function r(t){return t}t.exports=r},function(t,e,r){"use strict";function n(t){return u(t)?o(a(t)):i(t)}var o=r(155),i=r(156),u=r(71),a=r(100);t.exports=n},function(t,e){"use strict";function r(t){return function(e){return null==e?void 0:e[t]}}t.exports=r},function(t,e,r){"use strict";function n(t){return function(e){return o(e,t)}}var o=r(69);t.exports=n},function(t,e,r){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function o(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(r,o){var p=[].concat(n(i(t,e)),n(u(t,e)),n(a(t,e)),n(s(t,e)),n(c(t,e)),n(f(t,e)),n(l(t,e))),h=L(p);return h?r():o("Too many query structure errors: \n* "+p.join("\n* "))})}function i(t,e){var r=[],n=H(t,"dataset"),o=H(t,"branch"),i=H(t,"commit");return F(n)||W(n)||r.push("'dataset' clause must be string only"),F(o)||W(o)||r.push("'branch' clause must be string only"),F(i)||W(i)||r.push("'commit' clause must be string only"),r}function u(t,e){var r=[],o=H(t,"from",null);if(F(o)&&r.push("'from' clause couldn't be empty"),W(o)||r.push("'from' clause must be string only"),!J.AVAILABLE_FROM_CLAUSE_VALUES.has(o)){var i=[].concat(n(J.AVAILABLE_FROM_CLAUSE_VALUES));r.push("'from' clause must be one of the list: "+i.join(", "))}return r}function a(t,e){var r=[],n=H(t,"select",null),o=H(t,"from",null),i=H(n,"key"),u=H(n,"value");switch(!0){case J.isSchemaQuery(t):r.push(p(n),R(o,i),C(o,u));break;case J.isEntitiesQuery(t):r.push(p(n),D(n,i,u),I(o,i),C(o,u));break;case J.isConceptsQuery(t):r.push(p(n),D(n,i,u),I(o,i),C(o,u));break;case J.isDatapointsQuery(t):r.push(p(n),h(n,i,u),j(o,i),A(o,u));break;default:r.push(p(n))}return K(r)}function s(t,e){var r=[],n=H(t,"join",null),o=H(t,"where",null),i=O(o);return r.push(v(o),m(n,i)),K(r)}function c(t,e){var r=[],n=H(t,"language",null);switch(!0){case J.isSchemaQuery(t):r.push(P(t));break;case J.isEntitiesQuery(t):case J.isConceptsQuery(t):case J.isDatapointsQuery(t):default:r.push(y(n))}return K(r)}function f(t,e){var r=[],n=H(t,"join",null);switch(!0){case J.isSchemaQuery(t):r.push(T(t));break;case J.isEntitiesQuery(t):case J.isConceptsQuery(t):case J.isDatapointsQuery(t):default:r.push(d(n))}return K(r)}function l(t,e){var r=[],n=H(t,"order_by",null);return r.push(b(n)),K(r)}function p(t){if(F(t))return"'select' clause couldn't be empty"}function h(t,e,r){if(!M(t)||!N(e)||!N(r))return"'select' clause must have next structure: { key: [...], value: [...] }"}function d(t){if(!F(t)&&!_(t))return"'join' clause must be object only"}function y(t){if(!F(t)&&!W(t))return"'language' clause must be string only"}function v(t){if(!F(t)&&!_(t))return"'where' clause must be object only"}function m(t,e){var r=q(e,function(e){return!S(t,e)}).map(function(t){return t.name}),o=[].concat(n(J.AVAILABLE_QUERY_OPERATORS.values()),n(U(t)));if(!L(r))return"'where' clause has unknown operator(s) '"+r.join(", ")+"', replace it with allowed operators: "+o.join(", ")}function b(t){if(!(F(t)||W(t)||g(t)||x(t,w)))return"'order_by' clause must be string or array of strings || objects only"}function _(t){return M(t)&&!N(t)}function g(t){return N(t)&&G(t,W)}function w(t){return W(t)||_(t)&&1===$(t)&&J.AVAILABLE_ORDER_BY_CLAUSE_VALUES.has(B(z(t)))}function x(t,e){return N(t)&&G(t,e)}function S(t,e){return k(e)||E(t,e)}function k(t){return!t.isLeaf&&J.AVAILABLE_QUERY_OPERATORS.has(t.name)}function E(t,e){return e.isLeaf&&Q(e.name,"$")&&V(t,e.name)}function O(t){var e=[];for(var r in t)Q(r,"$")&&e.push({name:r,isLeaf:!1}),Y.isPrimitive(t[r])?Q(t[r],"$")&&e.push({name:t[r],isLeaf:!0}):e.push.apply(e,n(O(t[r])));return e}function j(t,e){if($(e)<2)return"'select.key' clause for '"+t+"' queries must have at least 2 items"}function A(t,e){
if($(e)<1)return"'select.value' clause for '"+t+"' queries must have at least 1 item"}function R(t,e){if(!N(e)||2!==$(e))return"'select.key' clause for '"+t+"' queries must have exactly 2 items: 'key', 'value'"}function C(t,e){if(!N(e)&&!F(e))return"'select.value' clause for '"+t+"' queries should be array of strings or empty"}function T(t){if(V(t,"join"))return"'join' clause for '*.schema' queries shouldn't be present in query"}function P(t){if(V(t,"language"))return"'language' clause for '*.schema' queries shouldn't be present in query"}function D(t,e,r){if(!M(t)||!N(e))return"'select' clause must have next structure: { key: [...], value: [...] }"}function I(t,e){if(!N(e)||1!==$(e))return"'select.key' clause for '"+t+"' queries must have only 1 item"}Object.defineProperty(e,"__esModule",{value:!0});var L=r(51),F=r(7),M=r(8),N=r(25),$=r(158),z=r(31),U=r(34),B=r(163),q=r(112),Q=r(105),H=r(68),V=r(164),G=r(166),K=r(107),W=r(24),J=r(110),Y=r(170);e.validateQueryStructure=o},function(t,e,r){"use strict";function n(t){if(null==t)return 0;if(u(t))return a(t)?s(t):t.length;var e=i(t);return e==c||e==f?t.size:o(t).length}var o=r(47),i=r(52),u=r(15),a=r(24),s=r(159),c="[object Map]",f="[object Set]";t.exports=n},function(t,e,r){"use strict";function n(t){return i(t)?u(t):o(t)}var o=r(160),i=r(161),u=r(162);t.exports=n},function(t,e,r){"use strict";var n=r(155),o=n("length");t.exports=o},function(t,e){"use strict";function r(t){return f.test(t)}var n="\\ud800-\\udfff",o="\\u0300-\\u036f",i="\\ufe20-\\ufe2f",u="\\u20d0-\\u20ff",a=o+i+u,s="\\ufe0e\\ufe0f",c="\\u200d",f=RegExp("["+c+n+a+s+"]");t.exports=r},function(t,e){"use strict";function r(t){for(var e=x.lastIndex=0;x.test(t);)++e;return e}var n="\\ud800-\\udfff",o="\\u0300-\\u036f",i="\\ufe20-\\ufe2f",u="\\u20d0-\\u20ff",a=o+i+u,s="\\ufe0e\\ufe0f",c="["+n+"]",f="["+a+"]",l="\\ud83c[\\udffb-\\udfff]",p="(?:"+f+"|"+l+")",h="[^"+n+"]",d="(?:\\ud83c[\\udde6-\\uddff]){2}",y="[\\ud800-\\udbff][\\udc00-\\udfff]",v="\\u200d",m=p+"?",b="["+s+"]?",_="(?:"+v+"(?:"+[h,d,y].join("|")+")"+b+m+")*",g=b+m+_,w="(?:"+[h+f+"?",f,d,y,c].join("|")+")",x=RegExp(l+"(?="+l+")|"+w+g,"g");t.exports=r},function(t,e,r){"use strict";t.exports=r(67)},function(t,e,r){"use strict";function n(t,e){return null!=t&&i(t,e,o)}var o=r(165),i=r(152);t.exports=n},function(t,e){"use strict";function r(t,e){return null!=t&&o.call(t,e)}var n=Object.prototype,o=n.hasOwnProperty;t.exports=r},function(t,e,r){"use strict";function n(t,e,r){var n=a(t)?o:i;return r&&s(t,e,r)&&(e=void 0),n(t,u(e,3))}var o=r(167),i=r(168),u=r(120),a=r(25),s=r(169);t.exports=n},function(t,e){"use strict";function r(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(!e(t[r],r,t))return!1;return!0}t.exports=r},function(t,e,r){"use strict";function n(t,e){var r=!0;return o(t,function(t,n,o){return r=!!e(t,n,o)}),r}var o=r(115);t.exports=n},function(t,e,r){"use strict";function n(t,e,r){if(!s(r))return!1;var n="undefined"==typeof e?"undefined":o(e);return!!("number"==n?u(r)&&a(e,r.length):"string"==n&&e in r)&&i(r[e],t)}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=r(88),u=r(15),a=r(42),s=r(8);t.exports=n},function(t,e){t.exports=require("util")},function(t,e,r){"use strict";function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t,e){var r=e.dataset,n=e.branch,o=e.commit;return""+t+r+"/"+n+"-"+o}function i(t){return t+"/datapackage.json"}function u(t,e){return new Promise(function(r){t.readText(i(e),function(t){return r(!t)})})}function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.__awaiter(this,void 0,void 0,regeneratorRuntime.mark(function r(){var a,s,h,d,y,v,m,b,_,g,w,x,S,k,E,O,j,A,R,C;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(s=l(e,"datasetsConfig",(a={},n(a,p.DEFAULT_DATASET_NAME,n({},p.DEFAULT_DATASET_BRANCH,[p.DEFAULT_DATASET_COMMIT])),n(a,"default",{dataset:p.DEFAULT_DATASET_NAME,branch:p.DEFAULT_DATASET_BRANCH,commit:p.DEFAULT_DATASET_COMMIT}),a)),h=s.default,d=h.dataset,y=h.branch,v=h.commit,m=t.dataset,b=t.branch,_=t.commit,g=t.dataset,w=void 0===g?d:g,x=t.branch,S=void 0===x?y:x,k=t.commit,E=void 0===k?v:k,O=l(e,"basePath",p.DEFAULT_DATASET_DIR),j=l(e,"fileReader"),A=w,!c(s[w])){r.next=9;break}throw new Error("No "+(c(m)?"default ":"")+"dataset '"+w+"' was found");case 9:if(!c(s[w][S])){r.next=11;break}throw new Error("No "+(c(b)?"default ":"")+"branch '"+S+"' in "+(c(m)?"default ":"")+"dataset '"+w+"' was found");case 11:if(f(s[w][S],E)){r.next=13;break}throw new Error("No "+(c(_)?"default ":"")+"commit '"+E+"' in "+(c(b)?"default ":"")+"branch '"+S+"' in "+(c(m)?"default ":"")+"dataset '"+w+"' was found");case 13:return R=void 0,C=void 0,r.prev=15,r.next=18,u(j,O);case 18:if(!r.sent){r.next=23;break}R=O,C=i(O),r.next=25;break;case 23:R=o(O,{dataset:w,branch:S,commit:E}),C=i(R);case 25:r.next=30;break;case 27:throw r.prev=27,r.t0=r.catch(15),r.t0;case 30:return Object.assign(t,{dataset:w,branch:S,commit:E}),Object.assign(e,{datasetPath:R,datapackagePath:C,datasetName:A}),r.abrupt("return",t);case 33:case"end":return r.stop()}},r,this,[[15,27]])}))}Object.defineProperty(e,"__esModule",{value:!0});var s=r(6),c=r(7),f=r(10),l=r(68),p=r(110);e.getDatasetPath=o,e.extendQueryParamWithDatasetProps=a}]);
//# sourceMappingURL=vizabi-ddfcsv-reader-node.js.map